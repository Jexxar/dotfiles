#!/usr/bin/env bash

if [ -f "$HOME/bin/mycommon" ]; then
    . "$HOME/bin/mycommon"
fi

function doMenu(){
    local opt=""
    local prpt="Pick a choice:"
    # l10n support
    case "${LANG:-}" in
        de_* ) opt=$(getOpt_en) ;; # Deutsch
        da_* ) opt=$(getOpt_en) ;; # Danish
        es_* ) opt=$(getOpt_en) ;; # EspaÃ±ola
        fr_* ) opt=$(getOpt_en) ;; # FranÃ§ais
        id_* ) opt=$(getOpt_en) ;; # Bahasa Indonesia
        it_* ) opt=$(getOpt_en) ;; # Italian
        lv_* ) opt=$(getOpt_en) ;; # Latvian
        pl_* ) opt=$(getOpt_en) ;; # Polish
        pt_* ) opt=$(getOpt_pt); prpt="Escolha uma opÃ§Ã£o:" ;; # PortuguÃªs
        ru_* ) opt=$(getOpt_en) ;; # Russian
        * ) getOpt_en ;; # Default to English
    esac
    local cmd=$(echo -e "$opt" | rofi -location 2 -font "Noto Sans 16" -dmenu -l 10 -line-margin 0 -line-padding 1 -xoffset 50 -yoffset 20 -width 20 -selected-row 0 -i -p "$prpt" $*)
    [ -z "$cmd" ] && return 0
    case "$cmd" in
        â»*)
            ~/bin/myshutdown
        ;;
        ğŸ—˜*)
            ~/bin/myreboot
        ;;
        â¾*)
            ~/bin/mysuspend
        ;;
        ğŸ—*)
            ~/bin/autolock lock
        ;;
        ï‚‹*)
            ~/bin/myexit
        ;;
        ğŸ—™*)
            echo ""
        ;;
        *)
            printf "Option not recognized: %s\n" "$cmd" >&2
        ;;
    esac
    return 0
}

function getOpt_en(){
    echo "â»\tPower off\nğŸ—˜\tReboot\nâ¾\tSuspend\nï‚‹\tLogout\nğŸ— \tLock session\nğŸ—™\tCancel"
}

function getOpt_pt(){
    echo "â»\tDesligar\nğŸ—˜\tReboot\nâ¾\tSuspender\nï‚‹\tSair\nğŸ— \tBloquear\nğŸ—™\tCancelar"
}

function main(){
    precheck "rofi"
    precheck "xset"

    # Only works if X is running.
    ! is_running_X && log "X server is not running" && return 0

    #local options="â»\tPower off\nğŸ—˜\tReboot\nâ¸\tSuspend\nâ¾\tHibernate\nğŸ—™\tLogout\nğŸ— \tLock session"
    doMenu

    #local cmd=$(printf "logout\npoweroff\nreboot\nsuspend\nlock\n" | rofi -location 2 -font "Noto Sans 8" -dmenu -l 10 -line-margin 0 -line-padding 1 -xoffset 50 -yoffset 20 -width 10 -i -p "Pick a choice:" $*)
    exit 0
}

main "$@"