#!/usr/bin/env bash
# This script is intended to be run as an editor helper.

if [ -f "$HOME/bin/mycommon" ]; then
    . "$HOME/bin/mycommon"
fi

XedtApps=('subl' 'subl3' 'sublime-text' 'geany' 'xed' 'gedit' 'pluma' 'leafpad' 'atom' 'vscode')

function has_editor(){
    local tmp="$(command -v $1)"
    echo "$tmp"
    [ -z "$tmp" ] && return 1 || return 0
}

function do_edit() {
    local edt=""
    
    if is_running_X ; then
        for i in "${XedtApps[@]}"; do
            edt=$(has_editor "${i}")
            if [ -n "$edt" ]; then
                $edt "$1"
                return 0
            fi
        done
    else
        edt=$(has_editor "nano")
        if [ -n "$edt" ]; then
            $edt "$1"
            return 0
        fi
    fi
    
    if [ -z "$edt" ]; then
        log "no editors found"
    fi
    
    return 0
}

function do_test() {
    local edt=""
    
    if [ ! -z "$1" ]; then
        log "target is $1"
    else
        log "no target found"
    fi
    
    if is_running_X ; then
        log "X is running"
    else
        log "X server down"
    fi
    
    for i in "${XedtApps[@]}"; do
        edt=$(has_editor "$i")
        if [ -n "$edt" ]; then
            log "$i present @ $edt"
        else
            log "$i not found"
        fi
    done
    
    edt=$(has_editor "nano")
   
    if [ -n "$edt" ]; then
        log "nano present @ $edt"
    else
        log "nano not found"
    fi
    
    return 0
}

cmd=${2:-edit}

case "$cmd" in
    edit)
        do_edit "$1"
    ;;
    debug)
        do_test "$1"
    ;;
    *)
        log "Unrecognized option: $2"
esac

unset XedtApps