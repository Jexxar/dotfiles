#!/usr/bin/env bash
# This script is intended to be run as an autostart/restart helper.

if [ -f "$HOME/bin/mycommon" ]; then
    . "$HOME/bin/mycommon"
fi

function main(){
    precheck "pgrep"
    precheck "pkill"
    [ $# -eq 0 ] && echo "Usage: $(basename $0) <executable name> <parameters>" && return 1
    local orig_cmd="$1"
    local validcmd="$(LC_ALL=C type -a $orig_cmd 2> /dev/null | grep -v "alias" | grep -v "keyword" | grep " is " | awk 'NR == 1 {print $1}')"
    [ -z "$validcmd" ] && echo -e "Invalid command $orig_cmd\nUsage: $(basename $0) <executable name> <parameters>" && return 1
    local cmd="$(command -v "$orig_cmd")"
    shift
    kill_them "but-me" "$orig_cmd"
    echo "Starting $cmd $@"
    log "Starting $cmd $@"
    $cmd "$@" &
    disown
    exit 0
}

main "$@"