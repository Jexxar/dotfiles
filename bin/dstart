#!/usr/bin/env bash
# This script is intended to be run as an autostart/restart helper.

if [ -f "$HOME/bin/mycommon" ]; then
    . "$HOME/bin/mycommon"
fi

function main(){
    precheck "pgrep"
    precheck "pkill"

    if [ $# -eq 0 ]; then
        echo "Usage: `basename $0` {executable_name parameters}"
        exit 0
    fi
    local orig_cmd="$1"
    local cmd="$(command -v "$orig_cmd")"
    local chkcmd="$(echo "$cmd" | grep "$orig_cmd")"
    shift
    kill_it "$orig_cmd"
    if [ -z "$chkcmd" ]; then
        echo "Starting $orig_cmd $@"
        log "Starting $orig_cmd $@"
        $orig_cmd "$@" &
        disown
    else
        echo "Starting $cmd $@"
        log "Starting $cmd $@"
        $cmd "$@" &
        disown
    fi
    exit 0
}

main "$@"