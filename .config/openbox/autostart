#!/bin/bash
# Script in $HOME/.config/openbox/autostart
# to run user-specific things.
#
#GLOBALAUTOSTART="/etc/xdg/openbox/autostart"

#. $GLOBALAUTOSTART

export OB_rc=0

if [ -e ~/.config/openbox/log/ob.log ]; then
    mv ~/.config/openbox/log/ob.log ~/.config/openbox/log/ob.2.log > /dev/null
    touch ~/.config/openbox/log/ob.log > /dev/null
fi

# Run XDG autostart things.  By default don't run anything desktop-specific
# See xdg-autostart --help more info
#DESKTOP_ENV="OPENBOX"
#if which /usr/lib/openbox/xdg-autostart >/dev/null 2>&1; then
#    sleep 1
#    OB_str="/usr/lib/openbox/xdg-autostart $DESKTOP_ENV"
#    OB_stts=""
#    /usr/lib/openbox/xdg-autostart $DESKTOP_ENV &
#    OB_rc=$?
#    if [ $OB_rc -eq 0 ]; then
#        OB_stts="Ok  "
#    else
#        OB_stts="Erro"
#    fi
#    echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log
#fi

# Start compton 
if [ $(pgrep -lfc compton) -ge 1 ] ; then
    killall compton > /dev/null
fi

sleep 1
OB_str="compton -b --config ~/.config/compton.conf"
OB_stts=""

compton -b --config ~/.config/compton.conf &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# If you want to use GNOME config tools...
# Start gnome-settings-daemon 
#if test -x /usr/lib/openbox/gnome-settings-daemon >/dev/null; then
#    sleep 1
#    OB_str="/usr/lib/openbox/gnome-settings-daemon"
#    OB_stts=""
#    
#    /usr/lib/openbox/gnome-settings-daemon &
#    
#    OB_rc=$?
#
#    if [ $OB_rc -eq 0 ]; then
#        OB_stts="Ok  "
#    else
#        OB_stts="Erro"
#    fi
#
#    echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log
#fi

# Start nitrogen
#sleep 1
OB_str="nitrogen --restore"
OB_stts=""

nitrogen --restore &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# launches a session dbus instance
OB_str="dbus-launch session"
OB_stts=""

if [ -z "$DBUS_SESSION_BUS_ADDRESS" ] && type dbus-launch >/dev/null; then
    sleep 1
    dbus-launch --sh-syntax --exit-with-session &
    OB_rc=$?
    if [ $OB_rc -eq 0 ]; then
        OB_stts="Ok  "
    else
        OB_stts="Erro"
    fi
    echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log
else
    echo "["`date +%F-%H:%M:%S`"] - dbus-launch ja ativo" >> ~/.config/openbox/log/ob.log
fi

# Stop gnome-keyring-daemon if it exists
if [ $(pgrep -lfc gnome-keyring-daemon) -ge 1 ] ; then
    killall gnome-keyring-daemon > /dev/null
fi

# Start gnome-keyring-daemon pkcs11,secrets,ssh
sleep 1
OB_str="/usr/bin/gnome-keyring-daemon --start --components=pkcs11,secrets,ssh"
OB_stts=""

/usr/bin/gnome-keyring-daemon --start --components=pkcs11,secrets,ssh &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# If you want to use Mate config tools...
# Start mate settings
if [ $(pgrep -lfc mate-settings-daemon) -ge 1 ] ; then
    killall mate-settings-daemon > /dev/null
fi
sleep 1
OB_str="mate-settings-daemon"
OB_stts=""

mate-settings-daemon &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# Start polkit deamon
sleep 1
OB_str="/usr/lib/x86_64-linux-gnu/polkit-mate-authentication-agent-1"
OB_stts=""

/usr/lib/x86_64-linux-gnu/polkit-mate-authentication-agent-1 &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# Start screensaver daemon
#sleep 1
#OB_str="cinnamon-screensaver"
#OB_stts=""

#cinnamon-screensaver &

#OB_rc=$?
#if [ $OB_rc -eq 0 ]; then
#    OB_stts="Ok  "
#else
#    OB_stts="Erro"
#fi
#echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# Start network manager
sleep 1
OB_str="/usr/bin/nm-applet"
OB_stts=""

/usr/bin/nm-applet &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# Start power manager deamon
if [ $(pgrep -lfc mate-power-manager) -ge 1 ] ; then
    killall mate-power-manager > /dev/null
fi

sleep 1
OB_str="mate-power-manager"
OB_stts=""

mate-power-manager &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# Update user dirs
sleep 1
OB_str="xdg-user-dirs-gtk-update"
OB_stts=""

xdg-user-dirs-gtk-update &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# Keyboard

#Sound Applet
if [ $(pgrep -lfc mate-volume-control-applet) -ge 1 ] ; then
    killall mate-volume-control-applet > /dev/null
fi

sleep 1
OB_str="mate-volume-control-applet"
OB_stts=""

mate-volume-control-applet &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

#locks screen after xx mins
if [ $(pgrep -lfc cinnamon-screensaver) -ge 1 ] ; then
    killall cinnamon-screensaver > /dev/null
fi

if [ $(pgrep -lfc mate-screensaver) -ge 1 ] ; then
    killall mate-screensaver > /dev/null
fi

#if [ $(pgrep -lfc xautolock) -ge 1 ] ; then
#    killall xautolock > /dev/null
#fi

sleep 1
OB_str="xautolock"
OB_stts=""

xautolock -detectsleep -noclose -time 5 -locker "\"$HOME/bin/autolock.sh lock\"" -notify 10 -notifier "\"$HOME/bin/autolock.sh notify\"" -killtime 10 -killer "\"$HOME/bin/autolock.sh suspend\"" &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# Start Conky
#if [ $(pgrep -lfc conky) -ge 1 ] ; then
#    killall conky > /dev/null
#fi

#sleep 1
#OB_str="~/bin/conky/conky-startup.sh"
#OB_stts=""

#~/bin/conky/conky-startup.sh &

#OB_rc=$?
#if [ $OB_rc -eq 0 ]; then
#    OB_stts="Ok  "
#else
#    OB_stts="Erro"
#fi
#echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# Tint2 panel
# 
if [ $(pgrep -lfc tint2) -ge 1 ] ; then
    killall tint2 > /dev/null
fi

sleep 1
OB_str="tint2"
OB_stts=""

tint2 &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# lighsOn
if [ $(pgrep -lfc lightsOn.sh) -ge 1 ] ; then
    killall lightsOn.sh > /dev/null
fi
sleep 1
OB_str="~/bin/lightsOn.sh 20"
OB_stts=""

~/bin/lightsOn.sh 20 &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

# lighsOn
if [ $(pgrep -lfc changer.sh) -ge 1 ] ; then
    killall changer.sh > /dev/null
fi
sleep 1
OB_str="~/bin/changer.sh"
OB_stts=""

~/bin/changer.sh &

OB_rc=$?
if [ $OB_rc -eq 0 ]; then
    OB_stts="Ok  "
else
    OB_stts="Erro"
fi
echo "["`date +%F-%H:%M:%S`"] - $OB_stts - $OB_rc - $OB_str" >> ~/.config/openbox/log/ob.log

export OB_rc

